{% extends "base.html" %}
{% load static %}

{% block title %}Student Dashboard - SmartGrader{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/student_dashboard.css' %}">
{% endblock %}

{% block content %}

<div class="student-container">
    <div class="dashboard-header">
        <h1>Student Dashboard</h1>
        <p>Welcome, {{ student.email }}</p>
    </div>

    <div class="enrollment-section">
        <h2>Enroll in a Test</h2>
        <form class="enroll-form" id="enroll-form">
            <input
                type="text"
                id="enrollment-code"
                placeholder="Enter enrollment code"
                maxlength="8"
                autocomplete="off"
                required
            >
            <button type="submit">Enroll</button>
        </form>
        <p class="enroll-hint">Enter the 8-character code provided by your teacher</p>
    </div>

    <div class="tests-section">
        <h2>My Tests</h2>

        {% if tests_data %}
            {% for item in tests_data %}
            <div class="test-card">
                <div class="test-card-header">
                    <h3 class="test-title">{{ item.test.title }}</h3>
                    {% if item.has_result %}
                        <span class="test-status status-completed">Graded</span>
                    {% elif item.submission %}
                        <span class="test-status status-pending">Submitted</span>
                    {% else %}
                        <span class="test-status status-enrolled">Enrolled</span>
                    {% endif %}
                </div>

                {% if item.test.description %}
                <p class="test-description">{{ item.test.description }}</p>
                {% endif %}

                <div class="test-meta">
                    <span>ğŸ“ {{ item.test.num_questions }} questions</span>
                    <span>ğŸ“… Enrolled {{ item.enrollment.enrolled_at|date:"M d, Y" }}</span>
                </div>

                {% if item.has_result %}
                <div class="test-result">
                    <div class="result-score">{{ item.submission.score }}/{{ item.test.num_questions }}</div>
                    <div class="result-details">{{ item.submission.percentage|floatformat:1 }}% â€¢ {{ item.submission.grade }}</div>
                    <a href="{% url 'student-test-result' item.test.id %}" class="btn-view-result">View Detailed Results</a>
                </div>
                {% elif item.submission %}
                <div class="test-result" style="border-left-color: #ffc107;">
                    <div class="result-details">Your submission is being processed. Check back later for results.</div>
                </div>
                {% else %}
                <div class="test-result" style="border-left-color: #667eea;">
                    <div class="result-details">Waiting for answer sheet to be uploaded and graded.</div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="no-tests">
                <div class="no-tests-icon">ğŸ“š</div>
                <p>You haven't enrolled in any tests yet</p>
                <p style="color: #666; font-size: 14px; margin-top: 10px;">Use the enrollment form above to join a test</p>
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'js/student_dashboard.js' %}"></script>
{% endblock %}
